<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Goal Tracker</title>
  <link rel="stylesheet" href="./css/default.css">
  <script type="text/javascript" src="./js/profile/properties.local.js"></script>
</head>

<body>

  <!-- ìƒë‹¨ ë©”ë‰´ -->
  <header>
    <div class="header-left">Goal Tracker</div>
    <div class="header-right">
      <button id="add-btn">ğŸ‘¥</button>
    </div>
  </header>

  <div id="timeline-page" class="list-container">
    <!-- í† ê¸€ ë²„íŠ¼ -->
    <div class="list-header">
    </div>
    <div class="list">
      <div class="list-item">
        <div class="thumbnail"></div>
        <div class="info">
          <div class="title">userë‹˜ì´ ì˜¤ëŠ˜ì˜ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤!</div>
        </div>
        <button class="like-btn" aria-label="ì¢‹ì•„ìš”">&#10084;</button>
        <button class="close-btn" aria-label="ì‚­ì œ">Ã—</button>
      </div>
      <div class="list-item">
        <div class="thumbnail"></div>
        <div class="info">
          <div class="title">userë‹˜ì´ ì¹œêµ¬ ì‹ ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤!</div>
        </div>
        <button class="accept-btn" aria-label="ì¹œêµ¬ì‹ ì²­ ìˆ˜ë½">+</button>
        <button class="close-btn" aria-label="ì‚­ì œ">Ã—</button>
      </div>
    </div>
    <!-- ë‹¬ì„±í‘œ ëª©ë¡ ì—†ì„ ë•Œ -->
    <div class="list empty" style="display:none;">
      <div class="empty-message">
        <span class="empty-icon">ğŸ“„</span>
        <span>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
      </div>
    </div>
  </div>
  
  <div class="alert-modal" id="alert-modal" style="display:none;">
    <div class="alert-content">
        <p id="alert-message">íŒì—… ì˜ˆì‹œ.</p>
        <button id="alert-close" onclick="hideAlert()">í™•ì¸</button>
    </div>
  </div>
  <script>
    // document.ready 
    document.addEventListener('DOMContentLoaded', function () {
      console.log('Document is ready with vanilla JavaScript!');
    });

    function callStampList(){
      apiFetch(`${ctx}/stamp/list`, {
            method: 'GET',
        })
        .then(data => {
          console.log(data);
          drawStampList(data);
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert("ìŠ¤íƒ¬í”„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.", () =>{
            location.href = './login.html';
          });
          return;
        });
    }

    // ìŠ¤íƒ¬í”„ ëª©ë¡ ê·¸ë¦¬ê¸° 
    function drawStampList(data){
      const listContainer = document.querySelector(".list");
      const emptyContainer = document.querySelector(".list.empty");

      // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
      listContainer.innerHTML = '';

      if (!data || data.length === 0) {
        emptyContainer.style.display = "flex";
        listContainer.style.display = "none";
        return;
      } else {
        emptyContainer.style.display = "none";
        listContainer.style.display = "block";
      }

      data.forEach(stamp => {
        const percent = Math.floor(stamp.progress_cnt / stamp.total_cnt * 100);
        const html = `
          <div class="list-item">
            <div class="thumbnail"></div>
            <div class="info">
              <div class="title">${stamp.stamp_nm}</div>
              <div class="progress">
                <div class="progress-bar" style="width: ${percent}%;"></div>
                <span class="progress-text">${stamp.progress_cnt}/${stamp.total_cnt}</span>
              </div>
            </div>
          </div>
        `;
        listContainer.insertAdjacentHTML('beforeend', html);
        const lastItem = listContainer.lastElementChild;
        lastItem.querySelector(".thumbnail").style.backgroundImage = `url(${stamp.image_url})`;
      });
    }

    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('like-btn')) {
        e.target.classList.toggle('liked');
      }
    });

  </script>
  <script type="text/javascript" src="./js/common.js"></script>
</body>

</html>