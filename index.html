<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Goal Tracker</title>
  <link rel="stylesheet" href="./css/default.css">
  <script type="text/javascript" src="./js/profile/properties.local.js"></script>
  <style>
    /* ...existing code... */
    .empty-message {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #bbb;
      font-size: 18px;
      height: 200px;
      gap: 8px;
      width: 100%;
    }

    .empty-icon {
      font-size: 32px;
      margin-bottom: 4px;
    }
  </style>
</head>

<body>

  <!-- ìƒë‹¨ ë©”ë‰´ -->
  <header>
    <div class="header-left">Goal Tracker</div>
    <div class="header-right">
      <button id="add-btn" onclick="location.href='/toy_front/add.html'">â•</button>
      <button id="settings-btn">âš™ï¸</button>
    </div>
  </header>

  <div class="list-container">
    <!-- í† ê¸€ ë²„íŠ¼ -->
    <div class="list-header">
      <label class="toggle-switch">
        <input type="checkbox" id="filter-toggle">
        <span class="slider"></span>
      </label>
      <span class="toggle-label">ì™„ë£Œë§Œ ë³´ê¸°</span>
    </div>
    <!-- ë‹¬ì„±í‘œ ëª©ë¡ -->
    <div class="list">
      <div class="list-item">
        <div class="thumbnail"></div>
        <div class="info">
          <div class="title">7ì¼ ë‹¬ì„±í‘œ</div>
          <div class="progress">
            <div class="progress-bar" style="width: 30%;"></div>
            <span class="progress-text">30/100</span>
          </div>
        </div>
        <button class="menu-btn">â‹®</button>
        <div class="dropdown">
          <button>í¸ì§‘</button>
          <button>ì‚­ì œ</button>
          <button>ê³µìœ </button>
        </div>
      </div>

      <div class="list-item">
        <div class="thumbnail" style="background-image:url('default-star.png');"></div>
        <div class="info">
          <div class="title">30ì¼ ë‹¬ì„±í‘œ</div>
          <div class="progress">
            <div class="progress-bar" style="width: 70%;"></div>
            <span class="progress-text">70/100</span>
          </div>
        </div>
        <button class="menu-btn">â‹®</button>
        <div class="dropdown">
          <button>í¸ì§‘</button>
          <button>ì‚­ì œ</button>
          <button>ê³µìœ </button>
        </div>
      </div>
    </div>
    <div class="list empty" style="display:none;">
      <div class="empty-message">
        <span class="empty-icon">ğŸ“„</span>
        <span>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
      </div>
    </div>
  </div>


  <div id="statistics-page" class="list-container" style="display:none;">
    <!-- í† ê¸€ ë²„íŠ¼ -->
    <div class="list-header">
    </div>
    <div class="list empty">
      <div class="empty-message">
        <span class="empty-icon">ğŸ’¦</span>
        <span>ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤...</span>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • í˜ì´ì§€ -->
  <div id="settings-page" class="page" style="display:none;">
    <header>
      <h1>ì„¤ì •</h1>
    </header>
    <div class="settings-list">
      <div class="setting-item">
        <label>
          <span>ì•Œë¦¼ ì¼œê¸°</span>
          <input type="checkbox" checked>
        </label>
      </div>
      <div class="setting-item">
        <label for="theme-select">í…Œë§ˆ ëª¨ë“œ</label>
        <select id="theme-select">
          <option value="light">ë¼ì´íŠ¸</option>
          <option value="dark">ë‹¤í¬</option>
        </select>
      </div>
      <div class="setting-item">
        <button id="reset-btn" class="btn">ëª¨ë“  ë‹¬ì„±í‘œ ì´ˆê¸°í™”</button>
      </div>
    </div>
  </div>
  <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="bottom-nav">
    <button class="nav-item active">
      <span>ğŸ </span>
      <span class="label">í™ˆ</span>
    </button>
    <button class="nav-item">
      <span>ğŸ“Š</span>
      <span class="label">í†µê³„</span>
    </button>
    <button class="nav-item">
      <span>âš™ï¸</span>
      <span class="label">ì„¤ì •</span>
    </button>
  </nav>
  
  <div class="alert-modal" id="alert-modal" style="display:none;">
    <div class="alert-content">
        <p id="alert-message">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</p>
        <button id="alert-close" onclick="hideAlert()">í™•ì¸</button>
    </div>
  </div>
  <script>
    // document.ready 
    document.addEventListener('DOMContentLoaded', function () {
      console.log('Document is ready with vanilla JavaScript!');
      
      const token = localStorage.getItem('access_token');
      if(token === null || token === undefined) {
        location.href = './login.html';
        return;
      }

      fetch(ctx + '/stamp', {
            method: 'GET',
            headers: {
              'Authorization': 'Bearer ' + token
            }
        })
        .then(response => response.json())
        .then(data => {
          console.log(data);
          drawStampList(data);
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert("ìŠ¤íƒ¬í”„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
          location.href = './login.html';
          return;
        });
      
    });

    // ìŠ¤íƒ¬í”„ ëª©ë¡ì— ìˆëŠ” ë“œë¡­ë‹¤ìš´ ë©”ë‰´ í† ê¸€ 
    document.querySelectorAll(".menu-btn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        const item = e.target.closest(".list-item");
        const dropdown = item.querySelector(".dropdown");

        // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.querySelectorAll(".list-item").forEach(i => {
          if (i !== item) i.classList.remove("show");
        });

        // í˜„ì¬ í† ê¸€
        item.classList.toggle("show");

        if (item.classList.contains("show")) {
          // ìœ„ì¹˜ ê³„ì‚°
          const rect = dropdown.getBoundingClientRect();
          if (rect.bottom > window.innerHeight) {
            dropdown.style.top = "auto";
            dropdown.style.bottom = "100%"; // ìœ„ë¡œ ì—´ë¦¼
          } else {
            dropdown.style.top = "100%";
            dropdown.style.bottom = "auto"; // ì•„ë˜ë¡œ ì—´ë¦¼
          }
        }
      });
    });

    // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener("click", (e) => {
      if (!e.target.closest(".list-item")) {
        document.querySelectorAll(".list-item").forEach(i => i.classList.remove("show"));
      }
    });

    function drawStampList(data){
      const listContainer = document.querySelector(".list");
      const emptyContainer = document.querySelector(".list.empty");

      // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
      listContainer.innerHTML = '';

      if (!data || data.length === 0) {
        emptyContainer.style.display = "flex";
        listContainer.style.display = "none";
        return;
      } else {
        emptyContainer.style.display = "none";
        listContainer.style.display = "block";
      }

      data.forEach(stamp => {
        // TODO: dataì— ë§ê²Œ ìˆ˜ì •
      });
    }

  </script>
  <script type="text/javascript" src="./js/common.js"></script>
</body>

</html>